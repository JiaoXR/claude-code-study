<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>无CSS测试版本</title>
    <!-- 完全不加载任何CSS样式 -->
</head>
<body>
    <h3>飞书收藏插件（无CSS测试版）</h3>
    
    <div>
        <h4>页面信息</h4>
        <p>标题: <span id="pageTitle">正在获取...</span></p>
        <p>URL: <span id="pageUrl"></span></p>
    </div>
    
    <form id="bookmarkForm">
        <div>
            <label for="descriptionInput">网站说明:</label><br>
            <input type="text" id="descriptionInput" placeholder="请输入网站说明">
        </div>
        <br>
        
        <div>
            <label for="noteInput">备注:</label><br>
            <textarea id="noteInput" rows="3" placeholder="备注信息"></textarea>
        </div>
        <br>
        
        <div>
            <label for="categorySelect">标签（单选）:</label><br>
            <select id="categorySelect">
                <option value="">请选择分类...</option>
                <option value="AI编程">AI编程</option>
                <option value="AI工具">AI工具</option>
                <option value="其他">其他</option>
            </select>
        </div>
        <br>
        
        <button type="submit" id="saveBtn">保存收藏</button>
        <button type="button" id="quickSaveBtn">快速收藏</button>
    </form>
    
    <div id="status" style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        状态: 准备就绪
    </div>

    <script>
        // 使用最干净的popup-clean.js逻辑，但适配这个简单的HTML结构
        class NoCSSFeishuBookmarkPopup {
            constructor() {
                this.currentPageInfo = null;
                this.init();
            }

            async init() {
                console.log('[NO-CSS] 初始化无CSS版本');
                await this.loadPageInfoOnce();
                this.setupEventListeners();
            }

            async loadPageInfoOnce() {
                try {
                    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
                    
                    this.currentPageInfo = {
                        title: tab.title || '',
                        url: tab.url,
                        timestamp: new Date().toISOString()
                    };

                    document.getElementById('pageTitle').textContent = this.currentPageInfo.title || '无标题';
                    document.getElementById('pageUrl').textContent = this.currentPageInfo.url || '';
                } catch (error) {
                    console.error('[NO-CSS] 获取页面信息失败:', error);
                    document.getElementById('status').textContent = '状态: 获取页面信息失败';
                }
            }

            setupEventListeners() {
                const saveBtn = document.getElementById('saveBtn');
                const quickSaveBtn = document.getElementById('quickSaveBtn');
                const form = document.getElementById('bookmarkForm');

                if (saveBtn) {
                    saveBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.saveBookmark();
                    });
                }

                if (quickSaveBtn) {
                    quickSaveBtn.addEventListener('click', () => {
                        this.quickSave();
                    });
                }

                if (form) {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveBookmark();
                    });
                }
            }

            async saveBookmark() {
                try {
                    document.getElementById('status').textContent = '状态: 正在保存...';
                    
                    const description = document.getElementById('descriptionInput').value.trim();
                    const note = document.getElementById('noteInput').value.trim();
                    const category = document.getElementById('categorySelect').value;

                    if (!description) {
                        document.getElementById('status').textContent = '状态: 请填写网站说明';
                        return;
                    }

                    const bookmarkData = {
                        url: this.currentPageInfo.url,
                        title: this.currentPageInfo.title,
                        description: description,
                        note: note,
                        category: category
                    };

                    const response = await chrome.runtime.sendMessage({
                        action: 'saveBookmark',
                        data: bookmarkData
                    });

                    if (response.success) {
                        document.getElementById('status').textContent = '状态: 收藏成功！';
                    } else {
                        document.getElementById('status').textContent = '状态: 保存失败 - ' + (response.error || '未知错误');
                    }
                } catch (error) {
                    console.error('[NO-CSS] 保存失败:', error);
                    document.getElementById('status').textContent = '状态: 保存失败';
                }
            }

            async quickSave() {
                try {
                    document.getElementById('status').textContent = '状态: 快速保存中...';
                    
                    const bookmarkData = {
                        url: this.currentPageInfo.url,
                        title: this.currentPageInfo.title,
                        description: this.currentPageInfo.title || '网站内容',
                        note: '',
                        category: '其他'
                    };

                    const response = await chrome.runtime.sendMessage({
                        action: 'saveBookmark',
                        data: bookmarkData
                    });

                    if (response.success) {
                        document.getElementById('status').textContent = '状态: 快速收藏成功！';
                    } else {
                        document.getElementById('status').textContent = '状态: 快速保存失败 - ' + (response.error || '未知错误');
                    }
                } catch (error) {
                    console.error('[NO-CSS] 快速保存失败:', error);
                    document.getElementById('status').textContent = '状态: 快速保存失败';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new NoCSSFeishuBookmarkPopup();
        });
    </script>
</body>
</html>